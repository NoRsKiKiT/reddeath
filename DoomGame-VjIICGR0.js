import{r as o,j as K}from"./index-Dqr3E2_7.js";const P=()=>{const h=o.useRef(null),x=o.useRef(0),[d,v]=o.useState(!1),[w,R]=o.useState(!1),[p,E]=o.useState(0),[g,T]=o.useState(1),[k,L]=o.useState(!1),l=o.useRef({x:100,y:200,width:50,height:60,speed:5,health:100,direction:1,isActive:!0,isEnemy:!1,spriteImage:null,spriteState:"idle",animationFrame:0}),f=o.useRef([]),u=o.useRef([]),c=o.useRef({name:"Shotgun",damage:20,fireRate:500,ammo:12,maxAmmo:12,image:null,shootSound:null,isReloading:!1,lastShootTime:0}),s=o.useRef({ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyA:!1,KeyD:!1,KeyW:!1,KeyS:!1,Space:!1}),a=o.useRef({backgroundMusic:new Audio,gunshot:new Audio,enemyHit:new Audio,playerHit:new Audio,reload:new Audio});o.useRef({background:new Image,player:new Image,enemy:new Image,weapon:new Image,bullet:new Image}),o.useEffect(()=>{const t=h.current;if(!t)return;t.width=640,t.height=360,(()=>{const n=t.getContext("2d");n&&(n.fillStyle="black",n.fillRect(0,0,t.width,t.height),n.fillStyle="red",n.font="bold 40px Arial",n.textAlign="center",n.fillText("DOOM REBORN",t.width/2,t.height/2-50),n.fillStyle="white",n.font="20px Arial",n.fillText("Нажмите ПРОБЕЛ чтобы начать",t.width/2,t.height/2+20),a.current.gunshot=new Audio,a.current.enemyHit=new Audio,a.current.playerHit=new Audio,a.current.reload=new Audio)})();const i=n=>{n.code==="Space"&&!d&&(v(!0),y()),Object.prototype.hasOwnProperty.call(s.current,n.code)&&(s.current[n.code]=!0),n.code==="KeyR"&&F(),n.code==="KeyF"&&D()},r=n=>{Object.prototype.hasOwnProperty.call(s.current,n.code)&&(s.current[n.code]=!1)};return window.addEventListener("keydown",i),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",r),cancelAnimationFrame(x.current)}},[]),o.useEffect(()=>{if(w){const t=h.current;if(!t)return;const e=t.getContext("2d");if(!e)return;e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,t.width,t.height),e.fillStyle="red",e.font="bold 40px Arial",e.textAlign="center",e.fillText("ИГРА ОКОНЧЕНА",t.width/2,t.height/2-50),e.fillStyle="white",e.font="20px Arial",e.fillText(`Счет: ${p}`,t.width/2,t.height/2),e.fillText("Нажмите ПРОБЕЛ для перезапуска",t.width/2,t.height/2+40);const i=r=>{r.code==="Space"&&(R(!1),E(0),T(1),window.removeEventListener("keydown",i),y())};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}}},[w,p]);const D=()=>{const t=h.current;t&&(k?document.exitFullscreen&&document.exitFullscreen():t.requestFullscreen&&t.requestFullscreen(),L(!k))},y=()=>{l.current={x:100,y:200,width:50,height:60,speed:5,health:100,direction:1,isActive:!0,isEnemy:!1,spriteImage:null,spriteState:"idle",animationFrame:0},c.current={name:"Shotgun",damage:20,fireRate:500,ammo:12,maxAmmo:12,image:null,shootSound:null,isReloading:!1,lastShootTime:0},f.current=[],u.current=[],A(),x.current=requestAnimationFrame(I)},F=()=>{c.current.ammo<c.current.maxAmmo&&!c.current.isReloading&&(c.current.isReloading=!0,a.current.reload&&a.current.reload.play().catch(t=>console.error("Error playing sound:",t)),setTimeout(()=>{c.current.ammo=c.current.maxAmmo,c.current.isReloading=!1},1500))},A=()=>{f.current=[];const t=3+g*2;for(let e=0;e<t;e++){const i={x:Math.random()*300+600,y:Math.random()*280+40,width:40,height:50,speed:1+g*.5,health:30+g*10,direction:-1,isActive:!0,isEnemy:!0,spriteImage:null,spriteState:"walk",animationFrame:0};f.current.push(i)}setTimeout(()=>{d&&!w&&A()},3e4)},O=()=>{const t=Date.now(),e=c.current;if(e.ammo<=0||e.isReloading||t-e.lastShootTime<e.fireRate)return;const i={x:l.current.x+l.current.width,y:l.current.y+l.current.height/2,size:5,speed:10,direction:l.current.direction,isActive:!0};u.current.push(i),e.ammo--,e.lastShootTime=t,a.current.gunshot&&a.current.gunshot.play().catch(r=>console.error("Error playing sound:",r)),e.ammo===0&&F()},j=()=>{u.current.forEach(t=>{t.isActive&&f.current.forEach(e=>{e.isActive&&t.x<e.x+e.width&&t.x+t.size>e.x&&t.y<e.y+e.height&&t.y+t.size>e.y&&(e.health-=c.current.damage,t.isActive=!1,a.current.enemyHit&&a.current.enemyHit.play().catch(i=>console.error("Error playing sound:",i)),e.health<=0&&(e.isActive=!1,E(i=>i+100),f.current.every(i=>!i.isActive)&&(T(i=>i+1),A())))})}),f.current.forEach(t=>{!t.isActive||!l.current.isActive||l.current.x<t.x+t.width&&l.current.x+l.current.width>t.x&&l.current.y<t.y+t.height&&l.current.y+l.current.height>t.y&&(l.current.health-=5,a.current.playerHit&&a.current.playerHit.play().catch(e=>console.error("Error playing sound:",e)),l.current.x-=20,l.current.health<=0&&(l.current.isActive=!1,R(!0)))})},I=()=>{const t=h.current;if(!t)return;const e=t.getContext("2d");if(!e)return;e.fillStyle="black",e.fillRect(0,0,t.width,t.height),e.fillStyle="#300",e.fillRect(0,0,t.width,t.height),e.fillStyle="#433",e.fillRect(0,t.height-60,t.width,60);const i=l.current;(s.current.ArrowLeft||s.current.KeyA)&&i.x>0?(i.x-=i.speed,i.direction=-1,i.spriteState="walk"):(s.current.ArrowRight||s.current.KeyD)&&i.x<t.width-i.width?(i.x+=i.speed,i.direction=1,i.spriteState="walk"):i.spriteState="idle",(s.current.ArrowUp||s.current.KeyW)&&i.y>40?i.y-=i.speed:(s.current.ArrowDown||s.current.KeyS)&&i.y<t.height-i.height-20&&(i.y+=i.speed),s.current.Space&&O(),u.current.forEach(r=>{r.isActive&&(r.x+=r.speed*r.direction,(r.x<0||r.x>t.width||r.y<0||r.y>t.height)&&(r.isActive=!1))}),f.current.forEach(r=>{if(r.isActive){const n=l.current.x-r.x,m=l.current.y-r.y,S=Math.sqrt(n*n+m*m);S>50&&(r.x+=n/S*r.speed,r.y+=m/S*r.speed),n>0?r.direction=1:r.direction=-1}}),j(),u.current=u.current.filter(r=>r.isActive),e.fillStyle="blue",e.fillRect(i.x,i.y,i.width,i.height),e.fillStyle="lightblue",e.beginPath(),e.arc(i.x+i.width/2,i.y+i.height/4,i.width/4,0,Math.PI*2),e.fill(),f.current.forEach(r=>{r.isActive&&(e.fillStyle="red",e.fillRect(r.x,r.y,r.width,r.height),e.fillStyle="orange",e.beginPath(),e.arc(r.x+r.width/2,r.y+r.height/4,r.width/4,0,Math.PI*2),e.fill(),e.fillStyle="orange",e.beginPath(),e.moveTo(r.x+r.width/4,r.y),e.lineTo(r.x+r.width/3,r.y-10),e.lineTo(r.x+r.width/2,r.y),e.fill(),e.beginPath(),e.moveTo(r.x+r.width*3/4,r.y),e.lineTo(r.x+r.width*2/3,r.y-10),e.lineTo(r.x+r.width/2,r.y),e.fill())}),u.current.forEach(r=>{r.isActive&&(e.fillStyle="yellow",e.fillRect(r.x,r.y,r.size,r.size))}),e.fillStyle="gray",e.fillRect(i.x+i.width-10,i.y+i.height/2,30,10),e.fillStyle="white",e.font="16px Arial",e.textAlign="left",e.fillText(`Здоровье: ${i.health}`,20,30),e.fillText(`Патроны: ${c.current.ammo}/${c.current.maxAmmo}`,20,50),e.fillText(`Счет: ${p}`,20,70),e.fillText(`Уровень: ${g}`,20,90),c.current.isReloading&&(e.fillStyle="yellow",e.fillText("Перезарядка...",150,50)),e.fillStyle="white",e.font="12px Arial",e.textAlign="right",e.fillText("WASD / Стрелки: движение",t.width-20,20),e.fillText("Пробел: стрельба",t.width-20,40),e.fillText("R: перезарядка",t.width-20,60),e.fillText("F: полный экран",t.width-20,80),d&&!w&&(x.current=requestAnimationFrame(I))};return K.jsx("div",{className:"w-full h-full bg-black flex items-center justify-center",children:K.jsx("canvas",{ref:h,className:"max-w-full max-h-full object-contain border border-gray-800",onClick:d?void 0:()=>{v(!0),y()}})})};export{P as default};
